---
title: "2020-04-16 Experiment Analysis"
output:
  html_document:
    keep_md: no
    toc: true
    toc_float: true
    toc_depth: 4
    collapsed: false
    theme: default
    code_folding: hide
  pdf_document:
    toc: true
    toc_depth: 4
---

## Analysis Dependencies

```{r, message=FALSE}
library(ggplot2)  # (Wickham, 2016)
library(tidyr)    # (Wickham and Henry, 2020)
library(dplyr)    # (Wickham et al., 2020)
library(reshape2) # (Wickham, 2007)
library(cowplot)  # (Wilke, 2019)
library(reticulate) 
```

We conducted these analyses using the following computing environment:

```{r}
print(version)
```

## Setup

```{r}
os <- import("os") # I'm a monster
data_dir <- "./data"
data_path <- os$path$join(data_dir, "agg_data.csv")
agg_data <- read.csv(data_path, na.strings="NONE")

agg_data$BIT_FLIP_PROB <- as.factor(agg_data$BIT_FLIP_PROB)

# Compute expected changes per generation
exp_change <- function(mag, interval) {
  if (interval == 0) { return(0) }
  else { return(mag / interval) }
}
agg_data$EXP_CHANGE_PER_GEN <- as.factor(mapply(exp_change, 
                                                agg_data$CHANGE_MAGNITUDE,
                                                agg_data$CHANGE_FREQUENCY))

theme_set(theme_cowplot())
```

## Analysis

### NK Fitness Model

Coding sites of representative organism as a function of mutation rate and environment change rates

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 0
phase <- 0
gen <- 50000
ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=EXP_CHANGE_PER_GEN, y=coding_sites, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Env. bits flipped per generation") +
  ylab("# coding sites in best organism") +
  theme(legend.position="none",
        axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/coding-sites-x-chg_grad-model-", gradient_model, 
               "_evo-phase-",phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=coding_sites, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  ylab("# coding sites in best organism") +
  theme(legend.position="none",
      axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/coding-sites-x-mut_grad-model-", gradient_model, 
               "_evo-phase-",phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

Fitnesses after 50k generations (phase 1)

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 0
phase <- 0
gen <- 50000
ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=EXP_CHANGE_PER_GEN, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Environment bits flipped per generation") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-chg_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=fitness, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-mut_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

Fitnesses after 60k generations (phase two - architecture lock-down)

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 0
phase <- 1
gen <- 60000
ggplot(filter(agg_data, GRADIENT_MODEL==gradient_model & evo_phase==phase & update==gen),
      aes(x=EXP_CHANGE_PER_GEN, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Env. bits flipped per generation") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-chg_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=fitness, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-mut_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

Fitness at 60K (phase two) vs coding sites

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 0
phase <- 1
gen <- 60000
ggplot(filter(agg_data, 
              GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=coding_sites, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_point() +
  facet_wrap(~ BIT_FLIP_PROB) +
  theme(legend.position="top") +
  ggsave(paste("./imgs/fitness-x-coding_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

### Gradient Fitness Model

Coding sites of representative organism as a function of mutation rate and environment change rates 

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 1
phase <- 0
gen <- 50000
ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=EXP_CHANGE_PER_GEN, y=coding_sites, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Env bit flips per generation") +
  ylab("# coding sites in best organism") +
  theme(legend.position="none",
        axis.text.x=element_text(angle=90)) +
  ggsave(paste("./imgs/coding-sites-x-chg_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=coding_sites, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  ylab("# coding sites in best organism") +
  theme(legend.position="none",
        axis.text.x=element_text(angle=90)) +
  ggsave(paste("./imgs/coding-sites-x-mut_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

```

Fitness after 50K generations (phase 1 of evolution)

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 1
phase <- 0
gen <- 50000
ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=EXP_CHANGE_PER_GEN, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Environment bits flipped per generation") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-chg_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=fitness, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-mut_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

Fitness after 60K generations (phase 2 of evolution)

```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 1
phase <- 1
gen <- 60000
ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=EXP_CHANGE_PER_GEN, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_boxplot() +
  facet_wrap(~ BIT_FLIP_PROB) +
  xlab("Environment bits flipped per generation") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-chg_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)

ggplot(filter(agg_data, GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=BIT_FLIP_PROB, y=fitness, color=BIT_FLIP_PROB)) +
  geom_boxplot() +
  facet_wrap(~ EXP_CHANGE_PER_GEN) +
  xlab("Bit-flip rate") +
  theme(legend.position="none",
    axis.text.x = element_text(angle=90)) +
  ggsave(paste("./imgs/fitness-x-mut_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```

Fitness at 60K (phase 2 of evolution) vs coding sites
```{r}
# Look at phase 1 representative organism coding sites
gradient_model <- 1
phase <- 1
gen <- 60000
ggplot(filter(agg_data, 
              GRADIENT_MODEL == gradient_model & evo_phase == phase & update == gen),
      aes(x=coding_sites, y=fitness, color=EXP_CHANGE_PER_GEN)) +
  geom_point() +
  facet_wrap(~ BIT_FLIP_PROB) +
  ylab("fitness") +
  theme(legend.position="top") +
  ggsave(paste("./imgs/fitness-x-coding_grad-model-", gradient_model, 
               "_evo-phase-", phase, "_gen-", gen, 
               ".pdf", sep=""), width=20, height=20)
```
